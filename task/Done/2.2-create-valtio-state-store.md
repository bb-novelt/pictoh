# Task 2.2: Create Valtio State Store

**Epic**: Epic 2: Core Data Models & State Management

## Task Details

- [ ] Create `state/store.ts` with main application state
- [ ] Initialize store with default values
- [ ] Create default "Home" page with unique `pageId`
- [ ] Implement state utility functions:
  - `getCurrentPage()` - get by `pageId`
  - `getSquareAtPosition(row, col)`
  - `updateSquare(squareId, updates)`
  - `addPage(pageName)` - generate unique `pageId`
  - `deletePage(pageId)` - delete by ID
  - `renamePage(pageId, newName)` - rename using ID

## Completion Summary

**Date Completed**: 2026-02-17

**Work Done**:

- Created `/apps/pictho-app/src/state/store.ts` with Valtio proxy state management
- Initialized store with default AppConfig values including:
  - Default "Home" page with unique pageId generated using crypto.randomUUID()
  - 24 empty squares in a 6x4 grid layout
  - Home page set as both homePageId and currentPageId
  - Edit mode disabled by default
- Implemented all required state utility functions:
  - `getCurrentPage()` - retrieves the current active page by pageId
  - `getSquareAtPosition(row, col)` - gets square at specific grid position
  - `updateSquare(position, updates)` - updates square properties using Object.assign
  - `addPage(pageName)` - creates new page with auto-generated unique pageId
  - `deletePage(pageId)` - deletes page by ID (prevents home page deletion)
  - `renamePage(pageId, newName)` - renames page using pageId
- Created barrel export in `/apps/pictho-app/src/state/index.ts`
- Verified build passes with `npx nx build pictho-app`
- All code formatted with Prettier and linted with ESLint

**Notes**:

- Used crypto.randomUUID() for generating unique page IDs (no external dependencies needed)
- Added safety check to prevent deletion of the home page
- When deleting the current page, automatically navigates back to home
- Store creates 24 squares (positions 0-23) for 6 columns Ã— 4 rows grid
- All utility functions properly handle cases where pages/squares may not exist

**Implementation Details**:

- Valtio proxy provides reactive state management
- State structure follows TypeScript types defined in `apps/pictho-app/src/types/index.ts`
- Helper functions `createEmptySquare()` and `createPage()` ensure consistent state initialization
- Build output shows new `state-vendor` chunk confirming Valtio integration

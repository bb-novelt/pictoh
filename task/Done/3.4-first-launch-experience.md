# Task 3.4: First Launch Experience

**Epic**: Epic 3: Offline-First Architecture

## Task Details

- [x] Create `FirstLaunchLoader` component
- [x] Show progress bar with percentage
- [x] Load everything completely before allowing app use (no lazy loading)
- [x] Track download progress for picture library and TTS model
- [x] Store first launch completion flag
- [x] Handle download errors gracefully
- [x] Only show app when 100% loaded

## Completion Summary

**Date Completed**: 2026-02-19

**Work Done**:

- Created `apps/pictho-app/src/firstLaunch/FirstLaunchLoader.tsx`:
  - Full-screen loading overlay using MUI `LinearProgress`, `Typography`, `Alert`
  - Starts the download Web Worker (`downloadWorker?worker`) on mount
  - Weighted progress: 30% base (app running) + 40% picture library + 30% TTS model
  - Handles `PROGRESS`, `PHASE_COMPLETE`, `ALL_COMPLETE`, and `ERROR` worker messages
  - Calls `onComplete` callback after a 500 ms display of 100% completion
  - Cancels and terminates worker on unmount

- Created `apps/pictho-app/src/firstLaunch/firstLaunchUtils.ts`:
  - `isFirstLaunch()` — checks for `pictoh-first-launch-complete` in localStorage
  - `markFirstLaunchComplete()` — writes ISO timestamp to localStorage
  - `getPictureUrls()` — returns picture URLs to pre-cache (empty array, populated in Task 8.1)
  - `getTtsModelUrls()` — returns TTS model URLs to pre-cache (empty array, populated in Task 5.3)

- Created `apps/pictho-app/src/firstLaunch/index.ts` — barrel export

- Updated `apps/pictho-app/src/app/app.tsx`:
  - Uses `isFirstLaunch()` to initialize state
  - Renders `<FirstLaunchLoader>` when first launch is pending; renders main app when done

**Notes**:

- The loader correctly handles empty picture/TTS URL arrays — the worker immediately sends `PHASE_COMPLETE` for each empty phase, then `ALL_COMPLETE`, so the loader completes instantly when there is nothing to download
- Utility functions are separated from the component file to satisfy the `react-refresh/only-export-components` lint rule
- localStorage errors (e.g. private browsing) are swallowed gracefully — `isFirstLaunch()` returns `false` so the loader is skipped rather than shown indefinitely
- All text is in French as required by the project specification

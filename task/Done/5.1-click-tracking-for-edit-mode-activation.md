# Task 5.1: Click Tracking for Edit Mode Activation

**Epic**: Epic 5: Square Interaction & TTS Integration

## Task Details

- [x] Implement click counter for the screen (not per square)
- [x] Track clicks within time window (e.g., short time)
- [x] Activate edit mode on 5th click anywhere on screen
- [x] Reset counter on timeout or mode change
- [ ] Add visual feedback during click counting (optional)

## File Location

Place all files for this task inside `src/editMode/` (feature folder for edit mode).
Example: `src/editMode/useClickTracker.ts`

## Completion Summary

**Date Completed**: 2026-02-23

**Work Done**:

- Created `src/editMode/useClickTracker.ts` — React hook that:
  - Listens for `click` events on `window` (global, not per-square)
  - Counts up to 5 clicks within a 2-second rolling window
  - Activates edit mode (calls `enableEditMode()`) on the 5th click
  - Resets the counter on timeout (2 s) or whenever `isEditMode` changes
    (using Valtio `subscribeKey` for mode-change detection)
  - Reads `store.isEditMode` directly from the Valtio proxy in the click
    handler to avoid stale-closure issues
- Created `src/editMode/index.ts` — barrel export for the feature folder
- Wired `useClickTracker()` into `src/app/app.tsx` so it is active globally
- Added `src/editMode/useClickTracker.test.ts` with 5 tests covering:
  - Activates on 5 clicks
  - Does not activate on fewer than 5 clicks
  - Resets counter after timeout
  - Ignores clicks when edit mode is already active
  - Resets counter when edit mode changes externally

**Notes**:

- Valtio's `subscribeKey` fires asynchronously (microtask), so tests that
  verify counter reset on mode change use `await Promise.resolve()` to flush
  the Valtio notification queue before asserting.
- Visual feedback during click counting was skipped (marked optional in spec).
